<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Relatório de Faltas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; background-color: white; }
            .container { box-shadow: none !important; border: none !important; padding: 0 !important; }
        }

        body { background-color: #f8f9fa; font-family: 'Segoe UI', system-ui, sans-serif; }

        .pendencia-destaque {
            font-size: 1.2rem;
            font-weight: 800;
            color: #dc3545; /* Vermelho forte */
        }

        .codigo-font {
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
    </style>
</head>
<body class="p-4">

<div class="container bg-white p-5 rounded shadow">

    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <div>
            <h2 class="fw-bold text-danger"><i class="bi bi-exclamation-triangle-fill"></i> Relatório de Faltas</h2>
            <h4 class="text-dark">OP: <span th:text="${op}" class="fw-bold"></span></h4>
        </div>
        <div class="text-end">
            <small class="text-muted d-block">Data de Emissão</small>
            <span class="fw-bold" th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
        </div>
    </div>

    <table class="table table-striped align-middle table-bordered">
        <thead class="table-dark">
        <tr>
            <th width="15%">Código</th>
            <th width="40%">Descrição</th>
            <th width="15%" class="text-center text-secondary bg-light border-secondary">Qtd. Encontrada</th>
            <th width="15%" class="text-end bg-danger text-white border-danger">Qtd. Faltante (Saldo)</th>
            <th width="15%" class="text-center">Local Original</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="item : ${faltantes}">
            <td>
                <span th:text="${item.codigo}" class="codigo-font fs-5"></span>
            </td>

            <td>
                <span th:text="${item.descricao}"></span>
                <div th:if="${item.codigoPai != null}" class="small text-muted fst-italic">
                    ↳ Kit: <span th:text="${item.codigoPai}"></span>
                </div>
            </td>

            <td class="text-center text-muted fw-bold bg-light">
                        <span th:text="${item.unidade == 'KG' || item.unidade == 'M'} ? ${#numbers.formatDecimal(item.qtdSeparada, 1, 2, 'POINT')} : ${#numbers.formatInteger(item.qtdSeparada, 0)}">
                        </span>
                <small th:text="${item.unidade}" style="font-size: 0.7em;"></small>
            </td>

            <td class="text-end pe-4 bg-danger bg-opacity-10">
                        <span class="pendencia-destaque"
                              th:text="${item.unidade == 'KG' || item.unidade == 'M'} ? ${#numbers.formatDecimal(item.saldoDevedor, 1, 2, 'POINT')} : ${#numbers.formatInteger(item.saldoDevedor, 0)}">
                        </span>
                <small class="text-muted fw-bold" th:text="${item.unidade}"></small>
            </td>

            <td class="text-center text-secondary">
                <small th:text="${item.local}"></small>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:if="${#lists.isEmpty(faltantes)}" class="alert alert-success text-center mt-5 p-5">
        <i class="bi bi-check-circle-fill display-1 d-block mb-3"></i>
        <h3 class="alert-heading fw-bold">Separação Completa!</h3>
        <p class="fs-5 mb-0">Nenhum item faltante para os filtros selecionados.</p>
    </div>

    <div class="mt-5 text-center no-print">
        <button onclick="window.print()" class="btn btn-dark btn-lg me-2 shadow">
            <i class="bi bi-printer"></i> Imprimir Relatório
        </button>
        <a href="/" class="btn btn-outline-secondary btn-lg">
            <i class="bi bi-arrow-left"></i> Voltar para Lista
        </a>
    </div>
</div>

</body>
</html>